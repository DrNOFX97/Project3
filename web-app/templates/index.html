<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conversational Agent</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        .conversation {
            border: 1px solid #ccc;
            padding: 10px;
            margin: 10px 0;
            max-height: 300px;
            overflow-y: scroll;
        }
        .message {
            margin: 5px 0;
        }
        .user {
            color: blue;
        }
        .bot {
            color: green;
        }
    </style>
</head>
<body>
    <h1>Conversational Agent</h1>
    <div>
        <input type="text" id="query" placeholder="Ask a question...">
        <button onclick="askQuestion()">Ask</button>
        <button onclick="startRecording()">Record</button>
    </div>
    <div class="conversation" id="conversation"></div>

    <script>
        // Function to add messages to the conversation div
        function addMessage(sender, text) {
            var conversation = $('#conversation');
            var message = $('<div>').addClass('message').addClass(sender.toLowerCase()).text(sender + ': ' + text);
            conversation.append(message);
            conversation.scrollTop(conversation[0].scrollHeight);
        }

        // Function to send text query to the backend
        function askQuestion() {
            var query = $('#query').val();
            addMessage('User', query);
            $.post('/ask', {query: query}, function(data) {
                addMessage('Bot', data.response);
            });
            $('#query').val('');  // Clear input after sending
        }

        // Function to handle voice recognition
        function startRecording() {
            var recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = 'en-US';
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;

            recognition.start();

            recognition.onresult = function(event) {
                var query = event.results[0][0].transcript;
                $('#query').val(query);
                askQuestion();
            };

            recognition.onspeechend = function() {
                recognition.stop();
            };

            recognition.onerror = function(event) {
                console.error('Speech recognition error', event.error);
            };
        }
    </script>
</body>
</html>
